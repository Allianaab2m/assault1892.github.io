---
title: "音声ファイルのお手軽抽出方法"
date: 2022-09-05
categories: ["雑多"]
tag: ["雑多"]
lead: "ゲームから音声ファイルを一瞬で抽出する方法です。誰得？"
description: "ゲームから音声ファイルを抽出する方法"
---

突然ですが，皆様はゲームを遊んでいる時にこのような事を思った事はありませんか？:

- この音楽かっこいいなぁ，聴きたい。
- NPC の無線ボイスをちゃんと聴きたい。
- ~~銃声がエロい！！~~

...通常のゲームでは，**音声ファイルを抽出する際は相当面倒な手段を取る必要があります**。  
例えば，Unity 製ゲームであれば**音声ファイルが含まれているであろうアセットファイルを見つけて，各種ツールを用いて抽出したりする必要があります**が，**Criware 等のミドルウェアを使っていると復号化をする必要があり，復号化キーの入手も相当面倒です**。  
さらに言えば，有名なゲームエンジンで開発されたゲームであれば軽くググるだけで大量に情報がヒットしますが，**そうでないゲーム（独自開発のエンジンや，exe 内にパッキングされている等）の場合はさらに面倒です**。嫌だ～～～！  
ですが，以下で紹介する方法を取ると，**特別暗号化されていない場合に限り**，手軽に音声ファイルを抽出する事が出来ます。

---

# Disclaimer

対象とするゲームは「有名なゲームエンジンで開発されたゲーム」**ではなく**，「よく分からんエンジンのゲーム」や「家庭用/携帯用ゲーム機のゲーム」等，**抽出する方法がさほど有名ではないゲーム**を対象としています。  
また，**このページで解説している内容はほぼ全てのゲームの利用規約に反する内容です**。また，ゲームによっては暗号化がされていますが，それを**復号化する行為に関しての適法性は保証しません**。  
抽出・解析したデータを公開する場合は著作権法に留意する必要があります。

TL;DR:

- Unity とか Unreal Engine のゲームならググれ
- ゲームにもよるけど，大体は規約違反だからやった事を公表すんのはやめとけ
- 暗号化されてんなら諦めた方がいい 復号化する行為の安全性に関しては保証できねえ
- ぶっこ抜いたデータを公開したりすんのはほぼ 100% 怒られるからやめろ

---

# 抽出

今回のページでは「[地球防衛軍 5](https://store.steampowered.com/app/1007040)」の無線ボイスを抽出し，本来ゲーム内では歌う事の出来ない「4 番以降の歌詞」を聞いてみます。

<details> <summary>EDF5のダイマ</summary>
地球防衛軍シリーズはゲームの仕様上PS4版だと重たくて仕方ないので，ゲーミングPCを持っている方ならSteamでPC版買った方が100倍良いです。

PC/PS4 間のクロスプレイは出来ませんが，キーボード/マウスでの直感的な操作と，全世界マッチメイクが出来，さらに (4.1 の頃でも出来ましたが) Cheat Engine や Trainer を使ったチートプレイも可能です。設計甘いせいでミッション進行止まったりする事あるからオンラインでは絶対チート使うなよ。

この前地球防衛軍 6 がリリースされましたが，Steam ではまだリリースされていないため，ストーリーの予習 + 操作に慣れるという面で Steam 版地球防衛軍 5 を購入して遊んでみる事をオススメします。</details>

## 用意するもの

- **正規の手段で入手した**ゲーム本体
- [foobar2000](https://www.foobar2000.org/)
- [vgmstream](https://vgmstream.org/)
- 抽出したいファイルの大体 2 から 2.5 倍ぐらいのストレージ
- 正しいファイルを見つけられるまでのやる気

「お前 foobar2000 って音楽プレイヤーだろ？そんなんで抽出出来ねえだろ」と思ったそこのあなた，[果たして本当にそうでしょうか？](https://vgmstream.org/)  
確かに **foobar2000 単体では**抽出は出来ません。ですが，後述する `vgmstream` というツール...を `foobar2000` で手軽に扱えるようにしたコンポーネントを使うと，なんと抽出出来るようになります。

別に海賊版ゲームでも抽出自体は出来ると思いますが，**倫理的にアレ**な~~のと一応こういうの書いておかないと割ってファイル抽出しようとするバカが出てくる~~ので，ちゃんと Steam から買いましょう。  
お金がないなら鍵屋から Steam のキーを買ってもいいと思いますが，リージョンロックには気を付けてください。  
正直**ゲームファイルの抽出や解析，復号化ってだけで黒に近いグレー**なので，これ以上アレな事をする意味はないです。

## 下ごしらえ

ここからは抽出のための準備を進めていきます。

### foobar2000

まずは `foobar2000` をインストールします。  
[ダウンロードページ](https://www.foobar2000.org/download/)にアクセスし，`Latest stable version`をクリックしてダウンロードし，インストールしてください。  
基本的にポータブルインストールはオススメしません。どうせ要らなくなったらアンインストールすればいいので。  
インストールが終わったら起動して，ファイルの関連付けを行います。といっても UAC が出てくるのでそれを許可するだけですが。

### vgmstream

次に `vgmstream` の `foobar2000 用コンポーネント` をインストールします。  
[ダウンロードページ](https://dl.vgmstream.org/)にアクセスし， `foobar2000 component` をクリックし，ダウンロードしてください。  
ダウンロードされた `foo_input_vgmstream.fb2k-component` をダブルクリックすると勝手に `foobar2000` が立ち上がってきてインストールするか聞かれるので，はいを押してインストールしてください。  
その後， `Apply` ボタンを押して指示に従って `foobar2000` を再起動すればインストールは完了です。

### 音声ファイルを抽出

抽出したい音声ファイルが含まれている**であろうファイル**をファイル名やサイズから特定していきます。  
今回は `無線ボイスを抽出し，本来ゲーム内では歌う事の出来ない「4 番以降の歌詞」を聞いてみる` が目的なので，無線っぽさそうなファイル名を探していきます。  
「地球防衛軍 5」の場合は `EARTH DEFENSE FORCE 5\SOUND\PC` に音声ファイルが格納されています。

「無線っぽさそうなファイル名」を適当に見た感じ，`TIKYUU5_VOICE.JA.AWB`が該当しました。  
これを `foobar2000` に放り込めば再生されます。

{{<figure src="./images/1.png" width=100% title="ファイル名は念のためモザイク。">}}

あとはこの中から歌声の場所を探し，mp3 に変換すれば抽出完了です。お手軽！

## なんか暗号化されてるっぽい場合は？

<details> <summary>言ってる事が正しいか自信がないため折り畳み</summary>
ゲームの音声ファイルを抽出しようとした際，音声ファイルが暗号化されている事があります。  
音声ファイルの実体は `HCA` ですが，それの解凍や再生に必要な鍵を `HCA鍵` と呼称します。  
この HCA 鍵は有名なゲーム，アプリであれば誰かが見つけた鍵が出回っている事が多いですが，マイナーなゲームやリリースされて間もない場合は自分で見つける必要があります。

Unity 製ゲームであれば，例えば Mod 等の手段で使用されているライブラリを改変し，[プロセス間の通信内容を吐き出させ，鍵を特定するといった手法](https://blog.mottomo.moe/categories/Tech/RE/en/2017-06-30-MLTD-HCA-Key-Extraction/) (リンク先は apk に含まれるライブラリの一部を改変するもの) や，  
特定のバイナリファイル（多くの場合は `level0` ）に HCA 鍵が含まれている事が多く，解析専用のツールを用いて根気強く調べ続ければそれらの鍵を見つける事が可能な場合があります。</details>

...根気強くやっていればいつかは辿り着けます。頑張って！

### 展開後のファイルの取り扱い

基本的には

- 公の場に**公開しない**
- 展開したファイルを何かの作品等に**使わない**
- ファイルを元に**悪意のあるツールを開発したりしない**

場合はおおよそ問題ないと思われます。  
しかし，**やっている事はリバースエンジニアリングに近く**，また**多くのゲームの利用規約で禁止されている行為**のため，聴きたいファイルを抽出して聴き終わったら**誰にも渡さずに削除する**事を強く推奨します。

どちらにせよ，**各個人の良識に従って行動すべき**ですが，あまりにも「調子に乗った事」をすると最悪**パブリッシャーやデベロッパー，或いはサービス運営から怒られを貰う**可能性があります。  
十分ご注意ください。
